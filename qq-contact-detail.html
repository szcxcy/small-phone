<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>è”ç³»äººè¯¦æƒ… - å¯çˆ±QQ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "å¾®è½¯é›…é»‘", sans-serif;
    }
    body {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
    }
    /* æ‰‹æœºå®¹å™¨ */
    .phone-screen {
      width: 375px;
      height: 812px;
      border: 1px solid #eee;
      border-radius: 40px;
      overflow: hidden;
      position: relative;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    /* è¿”å›é”® */
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 36px;
      height: 36px;
      background: #f8dce8;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(255,182,193,0.3);
      z-index: 999;
    }
    .back-btn::after {
      content: '';
      width: 14px;
      height: 14px;
      border-top: 2px solid #ffabb8;
      border-left: 2px solid #ffabb8;
      transform: rotate(-45deg);
    }
    /* è¯¦æƒ…é¡µèƒŒæ™¯ */
    .detail-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 200px;
      background: #f0f8ff;
      z-index: 980;
    }
    .detail-bg img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* è”ç³»äººå¤´åƒï¼ˆæ‚¬æµ®åœ¨èƒŒæ™¯ä¸Šï¼‰ */
    .contact-avatar {
      position: absolute;
      top: 140px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #eee;
      overflow: hidden;
      border: 4px solid #fff;
      z-index: 985;
    }
    .contact-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* è”ç³»äººåç§° */
    .contact-name {
      position: absolute;
      top: 270px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      color: #333;
      font-weight: bold;
      z-index: 985;
    }
    /* è”ç³»äººè®¾å®š */
    .contact-setting {
      position: absolute;
      top: 300px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #999;
      z-index: 985;
    }
    /* åŠŸèƒ½æŒ‰é’®åŒº */
    .btn-area {
      position: absolute;
      top: 340px;
      left: 0;
      width: 100%;
      padding: 0 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
      z-index: 985;
    }
    .func-btn {
      padding: 8px 20px;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .chat-btn {
      background: #ff69b4;
      color: #fff;
    }
    .dynamic-btn {
      background: #f5f5f5;
      color: #333;
    }
    /* å†…å®¹åŒºï¼ˆåŠ¨æ€ç©ºé—´ï¼‰ */
    .content-container {
      position: absolute;
      top: 400px;
      left: 0;
      width: 100%;
      height: calc(100% - 400px);
      padding: 20px;
      overflow-y: auto;
      z-index: 980;
    }
    /* ç©ºåŠ¨æ€æç¤º */
    .empty-dynamic {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #999;
      font-size: 14px;
    }
    .empty-dynamic-icon {
      font-size: 48px;
      margin-bottom: 10px;
      color: #eee;
    }
    /* åŠ¨æ€é¡¹ï¼ˆå¤ç”¨QQä¸»ç•Œé¢æ ·å¼ï¼‰ */
    .moment-item {
      padding: 15px;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      margin-bottom: 15px;
    }
    .moment-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .moment-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #eee;
      overflow: hidden;
      margin-right: 10px;
    }
    .moment-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .moment-name {
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }
    .moment-content {
      font-size: 14px;
      color: #333;
      margin-bottom: 10px;
      line-height: 1.5;
    }
    .moment-media {
      width: 100%;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .moment-media img, .moment-media video {
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="phone-screen">
    <!-- è¿”å›é”®ï¼ˆè¿”å›QQä¸»ç•Œé¢ï¼‰ -->
    <div class="back-btn" onclick="backToQQMain()"></div>
    <!-- è¯¦æƒ…é¡µèƒŒæ™¯ -->
    <div class="detail-bg" id="detailBg">
      <img src="app.img/default-bg.jpg" alt="è¯¦æƒ…é¡µèƒŒæ™¯">
    </div>
    <!-- è”ç³»äººå¤´åƒ -->
    <div class="contact-avatar" id="contactAvatar">
      <img src="app.img/default-contact.png" alt="è”ç³»äººå¤´åƒ">
    </div>
    <!-- è”ç³»äººåç§° -->
    <div class="contact-name" id="contactName">è”ç³»äººåç§°</div>
    <!-- è”ç³»äººè®¾å®š -->
    <div class="contact-setting" id="contactSetting">æš‚æ— è®¾å®š</div>
    <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
    <div class="btn-area">
      <button class="func-btn chat-btn" onclick="goToChat()">
        ğŸ’¬ å¼€å§‹èŠå¤©
      </button>
      <button class="func-btn dynamic-btn" onclick="goToContactDynamic()">
        ğŸ“± åŠ¨æ€ç©ºé—´
      </button>
    </div>
    <!-- å†…å®¹åŒºï¼ˆåŠ¨æ€ç©ºé—´ï¼‰ -->
    <div class="content-container" id="dynamicContainer">
      <div class="empty-dynamic">
        <div class="empty-dynamic-icon">ğŸ“±</div>
        <div>è¯¥è”ç³»äººæš‚æ— åŠ¨æ€</div>
      </div>
    </div>
  </div>

  <script>
    // æœ¬åœ°å­˜å‚¨Key
    const STORAGE_KEYS = {
      QQ: 'qqConfig'
    };
    // å½“å‰è”ç³»äººID
    let currentContactId = -1;
    // å½“å‰è”ç³»äººä¿¡æ¯
    let currentContact = null;

    // é¡µé¢åˆå§‹åŒ–ï¼šåŠ è½½è”ç³»äººä¿¡æ¯
    window.onload = initDetailPage();

    // 1. åˆå§‹åŒ–è¯¦æƒ…é¡µ
    function initDetailPage() {
      // è·å–å½“å‰è”ç³»äººID
      currentContactId = localStorage.getItem('currentContactId');
      if (!currentContactId) {
        // æ— IDæ—¶è¿”å›QQä¸»ç•Œé¢
        backToQQMain();
        return;
      }
      currentContactId = parseInt(currentContactId);

      // è¯»å–QQé…ç½®ï¼Œæ‰¾åˆ°å¯¹åº”è”ç³»äºº
      const savedQQ = localStorage.getItem(STORAGE_KEYS.QQ);
      if (!savedQQ) {
        backToQQMain();
        return;
      }
      const qqConfig = JSON.parse(savedQQ);
      currentContact = qqConfig.contacts.find(contact => contact.id === currentContactId);
      if (!currentContact) {
        backToQQMain();
        return;
      }

      // æ¸²æŸ“è”ç³»äººè¯¦æƒ…
      renderContactDetail();
      // æ¸²æŸ“è”ç³»äººåŠ¨æ€
      renderContactDynamic();
    }

    // 2. æ¸²æŸ“è”ç³»äººè¯¦æƒ…
    function renderContactDetail() {
      // æ¸²æŸ“èƒŒæ™¯
      const detailBg = document.getElementById('detailBg');
      detailBg.innerHTML = `<img src="${currentContact.bg || 'app.img/default-bg.jpg'}" alt="è¯¦æƒ…é¡µèƒŒæ™¯">`;
      // æ¸²æŸ“å¤´åƒ
      const contactAvatar = document.getElementById('contactAvatar');
      contactAvatar.innerHTML = `<img src="${currentContact.avatar || 'app.img/default-contact.png'}" alt="${currentContact.name}">`;
      // æ¸²æŸ“åç§°
      document.getElementById('contactName').textContent = currentContact.name;
      // æ¸²æŸ“è®¾å®š
      document.getElementById('contactSetting').textContent = currentContact.setting || 'æš‚æ— è®¾å®š';
    }

    // 3. æ¸²æŸ“è”ç³»äººåŠ¨æ€
    function renderContactDynamic() {
      const dynamicContainer = document.getElementById('dynamicContainer');
      const savedQQ = localStorage.getItem(STORAGE_KEYS.QQ);
      if (!savedQQ) return;

      const qqConfig = JSON.parse(savedQQ);
      // ç­›é€‰è¯¥è”ç³»äººçš„åŠ¨æ€
      const contactMoments = qqConfig.moments.filter(moment => moment.authorId === currentContact.id);

      if (contactMoments.length === 0) {
        dynamicContainer.innerHTML = `
          <div class="empty-dynamic">
            <div class="empty-dynamic-icon">ğŸ“±</div>
            <div>è¯¥è”ç³»äººæš‚æ— åŠ¨æ€</div>
          </div>
        `;
        return;
      }

      // æŒ‰æ—¶é—´é™åºæ’åº
      contactMoments.sort((a, b) => new Date(b.time) - new Date(a.time));

      // æ¸²æŸ“åŠ¨æ€åˆ—è¡¨
      let html = '';
      contactMoments.forEach(moment => {
        // å¤„ç†åª’ä½“å†…å®¹
        let mediaHtml = '';
        if (moment.media) {
          if (moment.media.type === 'image') {
            mediaHtml = `<div class="moment-media"><img src="${moment.media.url}" alt="åŠ¨æ€å›¾ç‰‡"></div>`;
          } else if (moment.media.type === 'video') {
            mediaHtml = `<div class="moment-media"><video controls src="${moment.media.url}"></video></div>`;
          }
        }

        // å¤„ç†è¯„è®º
        let commentHtml = '';
        if (moment.comments && moment.comments.length > 0) {
          moment.comments.forEach(comment => {
            commentHtml += `
              <div style="padding:5px 0; font-size:12px; color:#666;">
                <span style="color:#ff69b4;">${comment.authorName}ï¼š</span>${comment.content}
              </div>
            `;
          });
        }

        html += `
          <div class="moment-item">
            <div class="moment-header">
              <div class="moment-avatar">
                <img src="${moment.authorAvatar}" alt="${moment.authorName}">
              </div>
              <div class="moment-name">${moment.authorName}</div>
            </div>
            <div class="moment-content">${moment.content}</div>
            ${mediaHtml}
            ${commentHtml}
          </div>
        `;
      });

      dynamicContainer.innerHTML = html;
    }

    // 4. è·³è½¬èŠå¤©ç•Œé¢
    function goToChat() {
      // å­˜å‚¨å½“å‰èŠå¤©è”ç³»äººID
      localStorage.setItem('currentChatContactId', currentContactId);
      window.location.href = 'qq-chat.html';
    }

    // 5. è·³è½¬è”ç³»äººåŠ¨æ€é¡µï¼ˆç®€åŒ–ï¼Œæ­¤å¤„å¤ç”¨è¯¦æƒ…é¡µåŠ¨æ€åˆ—è¡¨ï¼‰
    function goToContactDynamic() {
      alert('å·²å±•ç¤ºè¯¥è”ç³»äººæ‰€æœ‰åŠ¨æ€ï½');
    }

    // 6. è¿”å›QQä¸»ç•Œé¢
    function backToQQMain() {
      // æ¸…é™¤ä¸´æ—¶å­˜å‚¨çš„è”ç³»äººID
      localStorage.removeItem('currentContactId');
      window.location.href = 'qq-main.html';
    }
  </script>
</body>
</html>
