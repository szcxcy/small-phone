<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, 1.0, user-scalable=no">
  <title>å¯çˆ±éŸ³ä¹æ’­æ”¾å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "å¾®è½¯é›…é»‘", sans-serif;
    }
    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
    }
    /* æ‰‹æœºå±å¹•å®¹å™¨ï¼ˆä¸æ¡Œé¢ç»Ÿä¸€å°ºå¯¸ï¼‰ */
   .phone-screen {
      width: 375px;
      height: 812px;
      border: 1px solid #eee;
      border-radius: 40px;
      overflow: hidden;
      position: relative;
      /* é»˜è®¤å¯çˆ±çº¯è‰²èƒŒæ™¯ */
      background: #fff0f5;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      transition: background 0.5s ease;
    }
    /* å¯çˆ±è¿”å›é”® */
   .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 36px;
      height: 36px;
      background: #f8dce8;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(255,182,193,0.3);
      z-index: 999;
    }
   .back-btn::after {
      content: '';
      width: 14px;
      height: 14px;
      border-top: 2px solid #ffabb8;
      border-left: 2px solid #ffabb8;
      transform: rotate(-45deg);
    }
    /* æ ‡é¢˜æ  */
   .title-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: 25px;
    }
   .title {
      font-size: 20px;
      font-weight: bold;
      color: #ff69b4;
    }
    /* å³ä¸Šè§’åŠ å·æŒ‰é’®ï¼ˆæ·»åŠ åŠŸèƒ½ï¼‰ */
   .add-btn {
      position: absolute;
      top: 25px;
      right: 20px;
      width: 36px;
      height: 36px;
      background: #ff69b4;
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      line-height: 36px;
      text-align: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(255,105,180,0.3);
      z-index: 998;
    }
    /* æ·»åŠ æ­Œæ›²å¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼‰ */
   .add-modal {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 280px;
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
    }
   .modal-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }
   .add-option {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f5f5f5;
      cursor: pointer;
    }
   .add-option:last-child {
      border-bottom: none;
    }
   .option-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            background: #f8dce8;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ff69b4;
        }
        .option-text {
            font-size: 14px;
            color: #555;
        }
        /* èƒŒæ™¯åˆ‡æ¢é€‰æ‹©å™¨ï¼ˆå¼¹çª—å†…ï¼‰ */
        .bg-select {
            margin-top: 15px;
        }
        .bg-title {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
        }
        .bg-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .bg-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .bg-color.active {
            border-color: #ff69b4;
        }
        .bg1 { background: #fff0f5; } /* é»˜è®¤ */
        .bg2 { background: #f0f8ff; }
        .bg3 { background: #f0fff0; }
        .bg4 { background: #fff8f0; }
        /* æœ¬åœ°å›¾ç‰‡èƒŒæ™¯é€‰é¡¹ */
        .bg-local-option {
            display: flex;
            align-items: center;
            padding: 10px 0;
            cursor: pointer;
        }
        #local-bg {
            display: none;
        }
        /* å…³é—­å¼¹çª—æŒ‰é’® */
        .close-modal {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
        }
        /* æ­Œå•åŒºåŸŸ */
        .playlist-container {
            width: 100%;
            height: calc(100% - 160px); /* å‡å»æ ‡é¢˜æ å’Œæ’­æ”¾æ é«˜åº¦ */
            margin-top: 20px;
            padding: 0 20px;
            overflow-y: auto;
        }
        .playlist-title {
            font-size: 16px;
            color: #ff69b4;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .song-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
        }
        .song-item:last-child {
            border-bottom: none;
        }
        .song-cover {
            width: 40px;
            height: 40px;
            background: #f8dce8;
            border-radius: 8px;
            margin-right: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ff69b4;
        }
        .song-info {
            flex: 1;
        }
        .song-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 3px;
        }
        .song-singer {
            font-size: 12px;
            color: #999;
        }
        /* åº•éƒ¨æ’­æ”¾æ  */
        .player-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: #fff;
            border-top: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        .now-playing-cover {
            width: 45px;
            height: 45px;
            background: #ff69b4;
            border-radius: 8px;
            margin-right: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
        }
        .play-info {
            flex: 1;
        }
        .play-song-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 3px;
        }
        .play-song-singer {
            font-size: 12px;
            color: #999;
        }
        .play-controls {
            display: flex;
            gap: 15px;
            color: #ff69b4;
            font-size: 20px;
        }
        .play-btn {
            width: 30px;
            height: 30px;
            background: #ff69b4;
            color: #fff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
        }
        /* æœ¬åœ°æ–‡ä»¶é€‰æ‹©éšè—åŸç”Ÿæ§ä»¶ */
        #local-audio {
            display: none;
        }
        /* æ­Œæ›²é“¾æ¥è¾“å…¥æ¡†ï¼ˆé»˜è®¤éšè—ï¼‰ */
        .link-input-container {
            margin-top: 15px;
            display: none;
        }
        .link-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #f5f5f5;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .confirm-link {
            width: 100%;
            padding: 8px;
            background: #ff69b4;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="phone-screen" id="playerScreen">
        <!-- è¿”å›é”®ï¼ˆåŠ å¼ºåŠŸèƒ½ï¼šè¿”å›æ¡Œé¢ä¸åœæ­¢éŸ³ä¹ï¼‰ -->
        <div class="back-btn" onclick="backToDesktop()"></div>
        
        <!-- æ ‡é¢˜æ  -->
        <div class="title-bar">
            <div class="title">å¯çˆ±éŸ³ä¹ç›’</div>
        </div>
        
        <!-- å³ä¸Šè§’åŠ å·æŒ‰é’® -->
        <button class="add-btn" onclick="showAddModal()">+</button>
        
        <!-- æ·»åŠ æ­Œæ›²å¼¹çª— -->
        <div class="add-modal" id="addModal">
            <div class="modal-title">æ·»åŠ æ­Œæ›² & åˆ‡æ¢èƒŒæ™¯</div>
            
            <!-- æ·»åŠ æ­Œæ›²é€‰é¡¹ -->
            <div class="add-option" onclick="selectLocalSong()">
                <div class="option-icon">ğŸ“‚</div>
                <div class="option-text">ä»æœ¬åœ°æ–‡ä»¶æ·»åŠ </div>
            </div>
            <div class="add-option" onclick="showLinkInput()">
                <div class="option-icon">ğŸ”—</div>
                <div class="option-text">é€šè¿‡é“¾æ¥æ·»åŠ </div>
            </div>
            
            <!-- æ­Œæ›²é“¾æ¥è¾“å…¥æ¡†ï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <div class="link-input-container" id="linkInputContainer">
                <input type="text" class="link-input" id="songLink" placeholder="è¾“å…¥æ­Œæ›²åœ¨çº¿é“¾æ¥ï¼ˆMP3æ ¼å¼ï¼‰">
                <button class="confirm-link" onclick="addLinkSong()">ç¡®è®¤æ·»åŠ </button>
            </div>
            
            <!-- èƒŒæ™¯åˆ‡æ¢ï¼ˆå«æœ¬åœ°å›¾ç‰‡é€‰é¡¹ï¼‰ -->
            <div class="bg-select">
                <div class="bg-title">é€‰æ‹©æ’­æ”¾å™¨èƒŒæ™¯</div>
                <div class="bg-options">
                    <div class="bg-color bg1" onclick="changeBg('bg1')"></div>
                    <div class="bg-color bg2" onclick="changeBg('bg2')"></div>
                    <div class="bg-color bg3" onclick="changeBg('bg3')"></div>
                    <div class="bg-color bg4" onclick="changeBg('bg4')"></div>
                </div>
                <!-- æœ¬åœ°å›¾ç‰‡èƒŒæ™¯é€‰æ‹© -->
                <div class="bg-local-option" onclick="selectLocalBg()">
                    <div class="option-icon">ğŸ–¼ï¸</div>
                    <div class="option-text">ä»æœ¬åœ°é€‰æ‹©å›¾ç‰‡èƒŒæ™¯</div>
                </div>
                <!-- éšè—çš„æœ¬åœ°å›¾ç‰‡é€‰æ‹©æ§ä»¶ -->
                <input type="file" id="local-bg" accept="image/*" onchange="setLocalBg(this)">
            </div>
            
            <!-- å…³é—­å¼¹çª— -->
            <button class="close-modal" onclick="hideAddModal()">å…³é—­</button>
            
            <!-- æœ¬åœ°æ–‡ä»¶é€‰æ‹©æ§ä»¶ï¼ˆéšè—ï¼‰ -->
            <input type="file" id="local-audio" accept="audio/*" onchange="addLocalSong(this)">
        </div>
        
        <!-- æ­Œå•åŒºåŸŸ -->
        <div class="playlist-container">
            <div class="playlist-title">æˆ‘çš„å¯çˆ±æ­Œå•</div>
            <div class="playlist" id="playlist">
                <!-- åŠ¨æ€æ¸²æŸ“æ­Œå• -->
            </div>
        </div>
        
        <!-- åº•éƒ¨æ’­æ”¾æ  -->
        <div class="player-bar">
            <div class="now-playing-cover" id="nowPlayingCover">â–¶</div>
            <div class="play-info">
                <div class="play-song-name" id="nowPlayingName">æœªæ’­æ”¾æ­Œæ›²</div>
                <div class="play-song-singer" id="nowPlayingSinger">--</div>
            </div>
            <div class="play-controls">
                <div class="prev-btn" onclick="playPrevSong()">â®</div>
                <div class="play-btn" id="playBtn" onclick="togglePlay()">â–¶</div>
                <div class="next-btn" onclick="playNextSong()">â­</div>
            </div>
            
            <!-- éŸ³é¢‘æ’­æ”¾å™¨ï¼ˆéšè—ï¼Œä»…ç”¨äºåˆå§‹åŠ è½½ï¼Œè·¨é¡µé¢ç”¨å…¨å±€Audioï¼‰ -->
            <audio id="audioPlayer" onended="playNextSong()">
                <source src="" type="audio/mpeg">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
            </audio>
        </div>
    </div>
    <script>
        // æœ¬åœ°å­˜å‚¨ Keyï¼ˆç»Ÿä¸€ç®¡ç†ï¼Œä¸æ¡Œé¢é¡µä¸€è‡´ï¼‰
        const STORAGE_KEY = 'musicPlayerConfig';
        // å…¨å±€å˜é‡ï¼ˆä¸æ¡Œé¢é¡µåŒæ­¥ï¼‰
        let currentSongIndex = -1;
        let songList = [];
        let playerConfig = {
            bgType: 'color', 
            bgValue: 'bg1',  
            currentSongId: -1,
            isPlaying: false // æ–°å¢ï¼šå­˜å‚¨æ’­æ”¾çŠ¶æ€ï¼Œç”¨äºè·¨é¡µé¢ç»­æ’­
        };
        // å…¨å±€Audioå¯¹è±¡ï¼ˆå…³é”®ï¼šå®ç°è·¨é¡µé¢ä¸åœæ­¢æ’­æ”¾ï¼‰
        let globalAudio = new Audio();
        // DOM å…ƒç´ 
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const nowPlayingCover = document.getElementById('nowPlayingCover');
        const nowPlayingName = document.getElementById('nowPlayingName');
        const nowPlayingSinger = document.getElementById('nowPlayingSinger');
        const playerScreen = document.getElementById('playerScreen');

        // é¡µé¢åˆå§‹åŒ–ï¼šåŠ è½½å­˜å‚¨ + æ¢å¤æ’­æ”¾ + åŒæ­¥å…¨å±€Audio
        initPlayer();

        // 1. åˆå§‹åŒ–æ’­æ”¾å™¨ï¼ˆæ ¸å¿ƒï¼šåŒæ­¥æ¡Œé¢é¡µæ’­æ”¾çŠ¶æ€ï¼‰
        function initPlayer() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const { songList: savedSongs, config: savedConfig } = JSON.parse(savedData);
                // åŠ è½½æ­Œå•
                songList = savedSongs || [{ 
                    id: 1, 
                    name: 'å°æ˜Ÿæ˜Ÿ', 
                    singer: 'å„¿ç«¥æ­Œè°£', 
                    url: 'https://music.163.com/song/media/outer/url?id=26182041.mp3' 
                }];
                // åŠ è½½é…ç½®ï¼ˆå«æ’­æ”¾çŠ¶æ€ï¼‰
                playerConfig = { ...playerConfig, ...savedConfig };
                // æ¢å¤èƒŒæ™¯
                restoreBackground();
                // æ¢å¤æ’­æ”¾ï¼šåŒæ­¥å…¨å±€Audio
                if (playerConfig.currentSongId !== -1) {
                    const targetSong = songList.find(song => song.id === playerConfig.currentSongId);
                    if (targetSong) {
                        currentSongIndex = songList.indexOf(targetSong);
                        nowPlayingName.textContent = targetSong.name;
                        nowPlayingSinger.textContent = targetSong.singer;
                        // åŒæ­¥å…¨å±€Audioæºå’ŒçŠ¶æ€
                        globalAudio.src = targetSong.url;
                        if (playerConfig.isPlaying) {
                            globalAudio.play().catch(err => console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥', err));
                            playBtn.textContent = 'â¸';
                            nowPlayingCover.textContent = 'â–¶';
                        }
                    }
                }
            } else {
                // æ— å­˜å‚¨æ—¶åˆå§‹åŒ–
                songList = [{ 
                    id: 1, 
                    name: 'å°æ˜Ÿæ˜Ÿ',
                    singer: 'å„¿ç«¥æ­Œè°£', 
                    url: 'https://music.163.com/song/media/outer/url?id=26182041.mp3' 
                }];
                playerConfig.bgType = 'color';
                playerConfig.bgValue = 'bg1';
                restoreBackground();
            }
            // æ¸²æŸ“æ­Œå•
            renderPlaylist();
            // ç›‘å¬å…¨å±€AudioçŠ¶æ€å˜åŒ–ï¼ŒåŒæ­¥ç•Œé¢
            syncAudioState();
        }

        // 2. åŒæ­¥å…¨å±€Audioæ’­æ”¾çŠ¶æ€åˆ°ç•Œé¢
        function syncAudioState() {
            globalAudio.addEventListener('play', () => {
                playerConfig.isPlaying = true;
                playBtn.textContent = 'â¸';
                nowPlayingCover.textContent = 'â–¶';
                saveToLocal(); // åŒæ­¥å­˜å‚¨çŠ¶æ€
            });
            globalAudio.addEventListener('pause', () => {
                playerConfig.isPlaying = false;
                playBtn.textContent = 'â–¶';
                nowPlayingCover.textContent = 'â¸';
                saveToLocal(); // åŒæ­¥å­˜å‚¨çŠ¶æ€
            });
        }

        // 3. ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæ–°å¢isPlayingçŠ¶æ€ï¼‰
        function saveToLocal() {
            const data = {
                songList: songList,
                config: {
                    bgType: playerConfig.bgType,
                    bgValue: playerConfig.bgType === 'color' ? playerConfig.bgValue : '',
                    currentSongId: currentSongIndex !== -1 ? songList[currentSongIndex].id : -1,
                    isPlaying: playerConfig.isPlaying // ä¿å­˜æ’­æ”¾çŠ¶æ€
                }
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // 4. æ¢å¤èƒŒæ™¯ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function restoreBackground() {
            if (playerConfig.bgType === 'color') {
                playerScreen.classList.remove('bg1', 'bg2', 'bg3', 'bg4');
                playerScreen.style.backgroundImage = 'none';
                playerScreen.classList.add(playerConfig.bgValue);
                document.querySelectorAll('.bg-color').forEach(bg => bg.classList.remove('active'));
                document.querySelector(`.bg-color.${playerConfig.bgValue}`)?.classList.add('active');
            } else {
                playerScreen.classList.remove('bg1', 'bg2', 'bg3', 'bg4');
                playerScreen.style.background = '#fff0f5';
                document.querySelector('.bg-color.bg1').classList.add('active');
                playerConfig.bgType = 'color';
                playerConfig.bgValue = 'bg1';
                saveToLocal();
            }
        }

        // 5. è¿”å›æ¡Œé¢ï¼ˆæ ¸å¿ƒï¼šä¸åœæ­¢éŸ³ä¹ï¼Œä»…è·³è½¬é¡µé¢ï¼‰
        function backToDesktop() {
            saveToLocal(); // ç¦»å¼€å‰ä¿å­˜æœ€æ–°çŠ¶æ€
            window.location.href = 'index.html'; // è·³è½¬ä¸å½±å“å…¨å±€Audioæ’­æ”¾
        }

        // 6. å¼¹çª—æ§åˆ¶ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function showAddModal() {
            document.getElementById('addModal').style.display = 'block';
            document.getElementById('linkInputContainer').style.display = 'none';
        }
        function hideAddModal() {
            document.getElementById('addModal').style.display = 'none';
        }

        // 7. æ­Œæ›²ç®¡ç†ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼Œæ–°å¢æ­Œæ›²ååŒæ­¥å­˜å‚¨ï¼‰
        function selectLocalSong() {
            document.getElementById('local-audio').click();
        }
        function addLocalSong(input) {
            const file = input.files[0];
            if (!file) return;
            const songUrl = URL.createObjectURL(file);
            const songName = file.name.replace(/\.[^/.]+$/, "");
            const songId = Date.now();
            songList.push({ id: songId, name: songName, singer: 'æœ¬åœ°æ–‡ä»¶', url: songUrl });
            renderPlaylist();
            saveToLocal();
            hideAddModal();
            input.value = '';
        }
        function showLinkInput() {
            document.getElementById('linkInputContainer').style.display = 'block';
        }
        function addLinkSong() {
            const songLink = document.getElementById('songLink').value.trim();
            if (!songLink || !songLink.endsWith('.mp3')) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ MP3 æ­Œæ›²é“¾æ¥ï½');
                return;
            }
            const             songId = Date.now();
            songList.push({ id: songId, name: 'è‡ªå®šä¹‰æ­Œæ›²', singer: 'åœ¨çº¿é“¾æ¥', url: songLink });
            renderPlaylist();
            saveToLocal();
            document.getElementById('songLink').value = '';
            document.getElementById('linkInputContainer').style.display = 'none';
            hideAddModal();
        }

        // 8. èƒŒæ™¯ç®¡ç†ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function changeBg(bgClass) {
            playerScreen.classList.remove('bg1', 'bg2', 'bg3', 'bg4');
            playerScreen.style.backgroundImage = 'none';
            playerScreen.classList.add(bgClass);
            playerConfig.bgType = 'color';
            playerConfig.bgValue = bgClass;
            saveToLocal();
            document.querySelectorAll('.bg-color').forEach(bg => bg.classList.remove('active'));
            document.querySelector(`.bg-color.${bgClass}`).classList.add('active');
        }
        function selectLocalBg() {
            document.getElementById('local-bg').click();
        }
        function setLocalBg(input) {
            const file = input.files[0];
            if (!file) return;
            const bgUrl = URL.createObjectURL(file);
            playerScreen.classList.remove('bg1', 'bg2', 'bg3', 'bg4');
            playerScreen.style.background = `url(${bgUrl}) no-repeat center/cover`;
            playerConfig.bgType = 'image';
            playerConfig.bgValue = bgUrl;
            document.querySelectorAll('.bg-color').forEach(bg => bg.classList.remove('active'));
            hideAddModal();
            input.value = '';
        }

        // 9. æ­Œå•æ¸²æŸ“ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function renderPlaylist() {
            const playlistDom = document.getElementById('playlist');
            playlistDom.innerHTML = '';
            if (songList.length === 0) {
                playlistDom.innerHTML = `
                    <div style="text-align:center; padding:20px; color:#999; font-size:13px;">
                        æ­Œå•ç©ºç©ºçš„ï½ æ·»åŠ æ­Œæ›²å§ï½
                    </div>
                `;
                return;
            }
            songList.forEach((song, index) => {
                const songItem = document.createElement('div');
                songItem.className = 'song-item';
                songItem.onclick = () => playSong(index);
                songItem.innerHTML = `
                    <div class="song-cover">ğŸµ</div>
                    <div class="song-info">
                        <div class="song-name">${song.name}</div>
                        <div class="song-singer">${song.singer}</div>
                    </div>
                `;
                playlistDom.appendChild(songItem);
            });
        }

        // 10. æ’­æ”¾æ§åˆ¶ï¼ˆæ ¸å¿ƒï¼šåŸºäºå…¨å±€Audioï¼ŒåŒæ­¥å­˜å‚¨çŠ¶æ€ï¼‰
        function playSong(index) {
            if (index === currentSongIndex && !globalAudio.paused) {
                togglePlay();
                return;
            }
            currentSongIndex = index;
            const song = songList[index];
            // ç”¨å…¨å±€Audioæ’­æ”¾ï¼Œè€Œéé¡µé¢å†…éšè—çš„audio
            globalAudio.src = song.url;
            globalAudio.play().catch(err => console.log('æ’­æ”¾å¤±è´¥', err));
            // æ›´æ–°ç•Œé¢å’Œé…ç½®
            nowPlayingName.textContent = song.name;
            nowPlayingSinger.textContent = song.singer;
            nowPlayingCover.textContent = 'â–¶';
            playBtn.textContent = 'â¸';
            playerConfig.currentSongId = song.id;
            playerConfig.isPlaying = true;
            saveToLocal(); // åŒæ­¥åˆ°å­˜å‚¨ï¼Œä¾›æ¡Œé¢é¡µè¯»å–
        }

        function togglePlay() {
            if (currentSongIndex === -1 && songList.length > 0) {
                playSong(0);
                return;
            }
            // æ§åˆ¶å…¨å±€Audioçš„æ’­æ”¾/æš‚åœ
            if (globalAudio.paused) {
                globalAudio.play();
                playBtn.textContent = 'â¸';
                nowPlayingCover.textContent = 'â–¶';
                playerConfig.isPlaying = true;
            } else {
                globalAudio.pause();
                playBtn.textContent = 'â–¶';
                nowPlayingCover.textContent = 'â¸';
                playerConfig.isPlaying = false;
            }
            saveToLocal(); // åŒæ­¥çŠ¶æ€åˆ°å­˜å‚¨
        }

        function playPrevSong() {
            if (songList.length === 0) return;
            currentSongIndex = (currentSongIndex - 1 + songList.length) % songList.length;
            playSong(currentSongIndex);
        }

        function playNextSong() {
            if (songList.length === 0) return;
            currentSongIndex = (currentSongIndex + 1) % songList.length;
            playSong(currentSongIndex);
        }

        // 11. é¡µé¢å…³é—­å‰åŒæ­¥çŠ¶æ€ï¼ˆé¿å…æ„å¤–åœæ­¢ï¼‰
        window.addEventListener('beforeunload', () => {
            saveToLocal();
            // ä¸æš‚åœå…¨å±€Audioï¼Œå®ç°è·³è½¬åç»§ç»­æ’­æ”¾
        });

        // 12. ç›‘å¬å­˜å‚¨å˜åŒ–ï¼ˆåŒæ­¥æ¡Œé¢é¡µæ“ä½œï¼‰
        window.addEventListener('storage', (e) => {
            if (e.key === STORAGE_KEY) {
                const savedData = JSON.parse(e.newValue);
                songList = savedData.songList;
                playerConfig = savedData.config;
                // åŒæ­¥å…¨å±€AudioçŠ¶æ€
                if (playerConfig.currentSongId !== -1) {
                    const targetSong = songList.find(song => song.id === playerConfig.currentSongId);
                    if (targetSong) {
                        currentSongIndex = songList.indexOf(targetSong);
                        globalAudio.src = targetSong.url;
                        if (playerConfig.isPlaying) {
                            globalAudio.play().catch(err => console.log('åŒæ­¥æ’­æ”¾å¤±è´¥', err));
                            playBtn.textContent = 'â¸';
                            nowPlayingCover.textContent = 'â–¶';
                        } else {
                            globalAudio.pause();
                            playBtn.textContent = 'â–¶';
                            nowPlayingCover.textContent = 'â¸';
                        }
                    }
                }
                renderPlaylist();
                restoreBackground();
            }
        });
    </script>
</body>
</html>


