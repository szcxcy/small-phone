<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>æ·»åŠ åŠ¨æ€ - å¯çˆ±QQ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "å¾®è½¯é›…é»‘", sans-serif;
    }
    body {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
    }
    /* æ‰‹æœºå®¹å™¨ */
    .phone-screen {
      width: 375px;
      height: 812px;
      border: 1px solid #eee;
      border-radius: 40px;
      overflow: hidden;
      position: relative;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    /* è¿”å›é”® */
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 36px;
      height: 36px;
      background: #f8dce8;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(255,182,193,0.3);
      z-index: 999;
    }
    .back-btn::after {
      content: '';
      width: 14px;
      height: 14px;
      border-top: 2px solid #ffabb8;
      border-left: 2px solid #ffabb8;
      transform: rotate(-45deg);
    }
    /* æ ‡é¢˜ */
    .page-title {
      position: absolute;
      top: 25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      color: #333;
      font-weight: bold;
      z-index: 990;
    }
    /* å†…å®¹åŒº */
    .content-container {
      position: absolute;
      top: 80px;
      left: 0;
      width: 100%;
      height: calc(100% - 140px);
      padding: 20px;
      overflow-y: auto;
      z-index: 980;
    }
    /* æ–‡æœ¬è¾“å…¥æ¡† */
    .moment-input {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 1px solid #f5f5f5;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.5;
      outline: none;
      resize: none;
      margin-bottom: 20px;
    }
    /* åª’ä½“æ·»åŠ åŒº */
    .media-add {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    .media-btn {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #666;
      font-size: 20px;
      cursor: pointer;
    }
    /* åª’ä½“é¢„è§ˆåŒº */
    .media-preview {
      width: 100%;
      min-height: 100px;
      border-radius: 10px;
      background: #f5f5f5;
      overflow: hidden;
      margin-bottom: 20px;
      display: none;
    }
    .media-preview.active {
      display: block;
    }
    .media-preview img, .media-preview video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* å‘é€æŒ‰é’® */
    .send-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      padding: 12px;
      background: #ff69b4;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      z-index: 990;
    }
    /* éšè—åŸç”Ÿæ–‡ä»¶é€‰æ‹©å™¨ */
    #image-input, #video-input {
      display: none;
    }
  </style>
</head>
<body>
  <div class="phone-screen">
    <!-- è¿”å›é”®ï¼ˆè¿”å›QQä¸»ç•Œé¢ï¼‰ -->
    <div class="back-btn" onclick="backToQQMain()"></div>
    <!-- æ ‡é¢˜ -->
    <div class="page-title">æ·»åŠ åŠ¨æ€</div>
    <!-- å†…å®¹åŒº -->
    <div class="content-container">
      <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
      <textarea class="moment-input" id="momentContent" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..."></textarea>
      
      <!-- åª’ä½“æ·»åŠ åŒº -->
      <div class="media-add">
        <div class="media-btn" onclick="selectImage()">ğŸ–¼ï¸</div>
        <div class="media-btn" onclick="selectVideo()">ğŸ¥</div>
      </div>
      
      <!-- åª’ä½“é¢„è§ˆåŒº -->
      <div class="media-preview" id="mediaPreview"></div>
      
      <!-- éšè—çš„æ–‡ä»¶é€‰æ‹©å™¨ -->
      <input type="file" id="image-input" accept="image/*" onchange="previewMedia('image', this)">
      <input type="file" id="video-input" accept="video/*" onchange="previewMedia('video', this)">
    </div>
    
    <!-- å‘é€æŒ‰é’® -->
    <button class="send-btn" onclick="sendMoment()">å‘é€åŠ¨æ€</button>
  </div>

  <script>
    // æœ¬åœ°å­˜å‚¨Key
    const STORAGE_KEYS = {
      QQ: 'qqConfig'
    };
    // ä¸´æ—¶åª’ä½“æ•°æ®
    let tempMedia = {
      type: null,
      url: null
    };

    // 1. åª’ä½“é€‰æ‹©ä¸é¢„è§ˆ
    function selectImage() {
      document.getElementById('image-input').click();
    }

    function selectVideo() {
      document.getElementById('video-input').click();
    }

    function previewMedia(type, input) {
      const file = input.files[0];
      if (!file) return;
      
      // å­˜å‚¨ä¸´æ—¶åª’ä½“æ•°æ®
      tempMedia.type = type;
      tempMedia.url = URL.createObjectURL(file);
      
      // æ¸²æŸ“é¢„è§ˆ
      const previewDom = document.getElementById('mediaPreview');
      previewDom.classList.add('active');
      if (type === 'image') {
        previewDom.innerHTML = `<img src="${tempMedia.url}" alt="åŠ¨æ€å›¾ç‰‡">`;
      } else if (type === 'video') {
        previewDom.innerHTML = `<video controls src="${tempMedia.url}"></video>`;
      }
      
      input.value = '';
    }

    // 2. å‘é€åŠ¨æ€
    function sendMoment() {
      const content = document.getElementById('momentContent').value.trim();
      if (!content && !tempMedia.url) {
        alert('è¯·è¾“å…¥åŠ¨æ€å†…å®¹æˆ–æ·»åŠ åª’ä½“ï¼');
        return;
      }

      // è¯»å–QQé…ç½®
      const savedQQ = localStorage.getItem(STORAGE_KEYS.QQ);
      const qqConfig = savedQQ ? JSON.parse(savedQQ) : {
        userAvatar: 'app.img/default-avatar.png',
        contacts: [],
        moments: []
      };

      // åˆ›å»ºæ–°åŠ¨æ€
      const newMoment = {
        id: Date.now(),
        authorId: 'user', // æ ‡è®°ä¸ºç”¨æˆ·åŠ¨æ€
        authorName: 'æˆ‘',
        authorAvatar: qqConfig.userAvatar,
        content: content,
        media: tempMedia.url ? {
          type: tempMedia.type,
          url: tempMedia.url
        } : null,
        time: new Date().toISOString(),
        comments: [] // åˆå§‹åŒ–ç©ºè¯„è®º
      };

      // æ·»åŠ åˆ°åŠ¨æ€åˆ—è¡¨
      qqConfig.moments.push(newMoment);
      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem(STORAGE_KEYS.QQ, JSON.stringify(qqConfig));

      // æ¨¡æ‹ŸAIè”ç³»äººå›å¤ï¼ˆç®€åŒ–ï¼šéšæœºé€‰ä¸€ä¸ªè”ç³»äººå›å¤ï¼‰
      if (qqConfig.contacts.length > 0) {
        const randomContact = qqConfig.contacts[Math.floor(Math.random() * qqConfig.contacts.length)];
        newMoment.comments.push({
          id: Date.now() + 1,
          authorId: randomContact.id,
          authorName: randomContact.name,
          authorAvatar: randomContact.avatar || 'app.img/default-contact.png',
          content: `æ”¯æŒä¸€ä¸‹ï¼${content ? content.slice(0, 10) + '...' : ''}`,
          time: new Date().toISOString()
        });
        // å†æ¬¡ä¿å­˜ï¼ˆå«AIå›å¤ï¼‰
        localStorage.setItem(STORAGE_KEYS.QQ, JSON.stringify(qqConfig));
      }

      // æç¤ºå¹¶è¿”å›QQä¸»ç•Œé¢
      alert('åŠ¨æ€å‘é€æˆåŠŸï¼');
      backToQQMain();
    }

    // 3. è¿”å›QQä¸»ç•Œé¢
    function backToQQMain() {
      window.location.href = 'qq-main.html';
    }
  </script>
</body>
</html>
